// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Ambassador {
  id            String   @id @default(cuid())
  email         String   @unique
  referral_code String   @unique
  total_earned  Int      @default(0)
  created_at    DateTime @default(now())
}

model ReferralVisit {
  id            String   @id @default(cuid())
  referral_code String
  created_at    DateTime @default(now())
  ip_hash       String
}

model Purchase {
   id                   String   @id @default(cuid())
   amount               Int      @default(11999)
   referral_code        String?
   ambassador_commission Int     @default(0)
   created_at           DateTime @default(now())
   payment_reference    String   @unique
}

model Client {
  id                String   @id @default(cuid())
  name              String
  email             String   @unique
  location          String // city, country
  desiredTitles     String[] // array of job titles
  industry          String
  workPreference    String // remote/hybrid/on-site
  yearsExperience   Int
  skills            String[] // array of skills
  cvText            String? // extracted CV text
  cvUrl             String? // if uploaded
  linkedinUrl       String?
  countriesToApply  String[] // array of countries
  consent           Boolean  @default(false)
  status            String   @default("intake") // intake, cv_optimized, jobs_sourced, applications_prepared, completed
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  jobs              Job[]
  applications      Application[]
}

model Job {
  id            String   @id @default(cuid())
  title         String
  company       String
  location      String
  platform      String // google, indeed, linkedin, etc.
  applicationLink String
  matchScore    Int // 0-100
  notes         String? // remote, hybrid, visa, etc.
  clientId      String
  client        Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  application   Application?
  createdAt     DateTime @default(now())
}

model Application {
  id               String   @id @default(cuid())
  jobId            String   @unique
  job              Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  coverLetter      String
  recruiterPitch   String
  screeningAnswers Json // object with question: answer
  clientId         String
  client           Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  submission       Submission?
  createdAt        DateTime @default(now())
}

model Submission {
  id            String      @id @default(cuid())
  applicationId String      @unique
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  submittedAt   DateTime?
  status        String      @default("pending") // pending, submitted, rejected, etc.
  notes         String?
  createdAt     DateTime    @default(now())
}
